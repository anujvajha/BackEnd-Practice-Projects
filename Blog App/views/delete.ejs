<%- include('partials/header'); -%>

<form>
    <h2>Delete your blog</h2>

    <label for="title">Title</label>
    <input type="text" name="title" required />
    <div class="title error"></div>

    <label for="author">Author</label>
    <input type="text" name="author" required />
    <div class="author error"></div>

    <button type="submit">Delete</button>
</form>

<script>
    const form = document.querySelector('form');
    const titleError = document.querySelector('.title.error');
    const authorError = document.querySelector('.author.error');

    form.addEventListener('submit', async (e) => 
    {
        e.preventDefault();


        titleError.textContent = '';
        authorError.textContent = '';

        const title = form.title.value;
        const author = form.author.value;

        try 
        {
            const result = await fetch('/blog/delete', 
            {  
                method: 'POST',
                body: JSON.stringify({ author,title}),
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include'
            });

            const data = await result.json();

            if (data.errors) 
            {
                titleError.textContent = data.errors.email;
                authorError.textContent = data.errors.password;
            }
            else 
            {
                location.assign('/');
            }
        } 
        catch (err) 
        {
            console.log(err);
        }
    });
</script>

<%- include('partials/footer'); -%>
