<%- include('partials/header'); -%>

<form>
    <h2>Create your own blog!</h2>

    <label for="title">Title</label>
    <input type="text" name="title" required />
    <div class="title error"></div>

    <label for="author">Author</label>
    <input type="text" name="author" required />
    <div class="author error"></div>

    <label for="content">Content</label>
    <textarea name="content" required></textarea>
    <div class="content error"></div>

    <button type="submit">Create</button>
</form>

<script>
    const form = document.querySelector('form');
    const titleError = document.querySelector('.title.error');
    const authorError = document.querySelector('.author.error');
    const contentError = document.querySelector('.content.error');

    form.addEventListener('submit', async (e) => 
    {
        e.preventDefault();


        titleError.textContent = '';
        authorError.textContent = '';
        contentError.textContent = '';

        const title = form.title.value;
        const author = form.author.value;
        const content = form.content.value;

        try 
        {
            const result = await fetch('/blog', 
            {  
                method: 'POST',
                body: JSON.stringify({ author,title,content }),
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include'
            });

            const data = await result.json();

            if (data.errors) 
            {
                titleError.textContent = data.errors.email;
                authorError.textContent = data.errors.password;
                contentError.textContent = data.errors.content;
            }
            else 
            {
                location.assign('/');
            }
        } 
        catch (err) 
        {
            console.log(err);
        }
    });
</script>

<%- include('partials/footer'); -%>
